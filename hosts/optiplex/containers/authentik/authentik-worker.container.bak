[Unit]
Description=Authentik task worker
Requires=authentik-media-volume.service
Requires=authentik-templates-volume.service
Requires=postgres.service
Requires=valkey.service
After=postgres.service
After=valkey.service

[Container]
ContainerName=authentik-worker
Image=ghcr.io/goauthentik/server
AutoUpdate=registry
Exec=worker
AutoUpdate=registry

HealthCmd="ak healthcheck"

Network=devops.network
HostName=authentik-worker

Environment="AUTHENTIK_SECRET_KEY=9BnCbcBIy779xzcbHIHkTFaI24AeBJGz5O9gr7cVrTnYS1TFtkxNrujyaIeQW6YSKs51xf6q3xYcYtcB"
Environment="AUTHENTIK_REDIS__HOST=valkey"
Environment="AUTHENTIK_POSTGRESQL__HOST=postgres"
Environment="AUTHENTIK_POSTGRESQL__USER=authentik"
Environment="AUTHENTIK_POSTGRESQL__NAME=authentik"
Environment="AUTHENTIK_POSTGRESQL__PASSWORD=LoaI5k9MFwtlzCeQnFn8xHPAZsr"

Volume=authentik-media.volume:/media:z
Volume=authentik-templates.volume:/templates:z
Volume=%h/Optiplex/containers/.certs/authentik.lab:/certs:z

[Service]
Restart=always
TimeoutStartSec=1000

[Install]
WantedBy=default.target
